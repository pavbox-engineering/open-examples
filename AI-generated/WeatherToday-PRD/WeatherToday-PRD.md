# Weather Today — Product Requirements Document (PRD)

### 1. Purpose

Дать пользователю быстрый и удобный способ узнать прогноз погоды на выбранный период через Telegram-бота с возможностью вручную указать свой город или координаты, с валидацией и поддержкой поиска по альтернативным названиям городов.  

### 2. Value & Audience

- **Портрет ЦА:**  
  - Возраст: 18–45 лет  
  - Контекст: жители городов, часто пользующиеся Telegram, которым важно быстро получать актуальную погоду без лишних приложений.

- **Основные боли:**  
  - Сложность и перегруженность стандартных погодных приложений.
  - Необходимость быстро узнать погоду на конкретную дату или период.
  - Отсутствие удобного доступа к погоде в привычном мессенджере.

### 3. Solution Overview

- **Описание продукта:**  
  Telegram-бот, который по запросу пользователя показывает прогноз погоды на завтра, на месяц или на выбранную дату, используя Open-Meteo API. Пользователь вручную указывает свой город или координаты в настройках, автоматический запрос геолокации не используется. Для определения координат по названию города используется OpenStreetMap, все введённые данные проходят валидацию, поддерживается поиск по альтернативным названиям городов (включая опечатки и транслитерацию).

- **Ключевые user-flow:**  
  - Пользователь запускает бота и видит приветствие с кнопками выбора периода прогноза.
  - Нажимает "На завтра" — получает прогноз на следующий день для своей локации.
  - Нажимает "На месяц" — получает краткий прогноз на 30 дней для своей локации.
  - Нажимает "Указать дату" — выбирает дату, получает прогноз на выбранный день.
  - В настройках указывает или изменяет свою локацию: вводит город (с поддержкой альтернативных названий/опечаток/транслитерации) или координаты (широта/долгота).
  - Если введён город, бот определяет координаты через OpenStreetMap.
  - Все введённые пользователем данные проходят валидацию (корректность координат, существование города).
  - При ошибке API или недоступности данных — получает информативное сообщение.

- **High-level архитектура:**

```
+-------------------+      +-------------------+      +----------------------+
|   Telegram User   |<---> |   Telegram Bot    |<---> |   Open-Meteo API     |
+-------------------+      +-------------------+      +----------------------+
                                   |
                                   v
                           +------------------+
                           |  Python Backend  |
                           +------------------+
                                   |
                                   v
                        +------------------------+
                        | OpenStreetMap Geocoding|
                        +------------------------+
```

### 4. Detailed Functional Requirements

#### Epic 1: Получение прогноза погоды

- **US-1:** Как пользователь, я хочу выбрать период прогноза (завтра/месяц/дату), чтобы быстро узнать нужную мне погоду.  
  - Acceptance Criteria:
    - После запуска бота отображаются кнопки "На завтра", "На месяц", "Указать дату". (P0)
    - При нажатии на кнопку бот запрашивает и возвращает прогноз для выбранной локации. (P0)
    - Для "Указать дату" бот запрашивает дату и возвращает прогноз. (P0)

- **US-2:** Как пользователь, я хочу получать информативные сообщения об ошибках, чтобы понимать, что делать дальше.  
  - Acceptance Criteria:
    - При ошибке API или отсутствии данных бот сообщает об этом понятным языком. (P1)

#### Epic 2: Управление локацией

- **US-3:** Как пользователь, я хочу указать или изменить свою локацию в настройках, чтобы получать актуальный прогноз для нужного мне места.  
  - Acceptance Criteria:
    - В меню настроек есть кнопка "Изменить локацию". (P0)
    - Пользователь может ввести город (с поддержкой альтернативных названий, опечаток, транслитерации) или координаты (широта/долгота). (P0)
    - Если введён город, бот определяет координаты через OpenStreetMap. (P0)
    - Все введённые данные проходят валидацию:  
      - Координаты должны быть в допустимом диапазоне.  
      - Город должен существовать (поиск через OpenStreetMap, с учётом альтернативных названий). (P0)
    - Бот подтверждает сохранение новой локации. (P0)
    - Если локация не задана, бот просит указать её при первом запросе прогноза. (P0)
    - Автоматический запрос геолокации не используется. (P0)

#### Epic 3: Интеграция с Open-Meteo API

- **US-4:** Как разработчик, я хочу, чтобы бот использовал Open-Meteo API, чтобы получать бесплатные погодные данные.  
  - Acceptance Criteria:
    - Используется Open-Meteo API для всех запросов погоды. (P0)
    - Документирован способ смены API-ключа или провайдера (на случай будущих изменений). (P1)

#### Epic 4: Локализация и UX

- **US-5:** Как пользователь, я хочу видеть все сообщения и кнопки на русском языке, чтобы пользоваться ботом было удобно.  
  - Acceptance Criteria:
    - Весь интерфейс и ответы бота на русском. (P0)

### 5. Non-Functional Requirements

- SLA: 99% uptime.
- Latency: ответ пользователю не более 3 секунд.
- Security: не хранить персональные данные, использовать только официальные Telegram API.
- GDPR: не собирать и не хранить пользовательские данные.
- Rate-limits: соблюдать лимиты Telegram, Open-Meteo API и OpenStreetMap.

### 6. MVP Scope

- Telegram-бот с кнопками "На завтра", "На месяц", "Указать дату".
- Интеграция с Open-Meteo API.
- Возможность указать/изменить локацию (город или координаты) вручную.
- Геокодинг города в координаты через OpenStreetMap с поддержкой альтернативных названий.
- Валидация введённых пользователем данных.
- Ответы на русском языке.
- Обработка ошибок API.
- Документация по запуску и смене API-ключа.

### 7. Metrics of Success

- DAU (ежедневные активные пользователи).
- % успешных ответов на запросы (ошибки API < 2%).
- Среднее время ответа бота (< 3 секунд).

### 8. Launch & Roll‑out Plan

- Этап 1: Внутренний тест Telegram-бота (1–2 дня).
- Этап 2: Открытая бета для ограниченного числа пользователей (до 50).
- Этап 3: Сбор обратной связи, исправление багов.
- Этап 4: Публичный релиз.
- Чек-лист релиза:
  - Протестированы все user-flow.
  - Проверена работа с Open-Meteo API и OpenStreetMap.
  - Проверена валидация данных и поддержка альтернативных названий городов.
  - Проверена локализация.
  - Документация готова.

### 9. Risks & Mitigations

- **Риск:** Open-Meteo API или OpenStreetMap перестанет работать или введет лимиты.  
  - План B: Быстрая смена провайдера, абстракция слоя API.
- **Риск:** Telegram изменит правила или API.  
  - План B: Мониторинг изменений, обновление кода.
- **Риск:** Высокая нагрузка приведет к блокировке по rate-limit.  
  - План B: Кэширование популярных запросов, уведомление пользователя о задержке.